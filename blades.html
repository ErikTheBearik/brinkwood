<div class="preload"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/xptooth-red.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/xptooth-white.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-red.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-black.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-halfgrey.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-white.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/shorttooth-red.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/shorttooth-grey.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-insight.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-prowess.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-resolve.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-hunt.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-study.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-survey.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-tinker.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-finesse.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-prowl.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-skirmish.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-wreck.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-attune.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-command.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-consort.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-sway.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-fortune.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-vice.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-crew_tier.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-entanglement.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-cohort_quality.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-lifestyle.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-recovery.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-engagement.png"/><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-harm.png"/>
</div>
<div>
  <input type="hidden" name="attr_stress_max" value="6"/>
  <input type="hidden" name="attr_scars_max" value="4"/>
  <input type="hidden" name="attr_oath_max" value="4"/>
  <input type="hidden" name="attr_coin_max" value="4"/>
  <input type="hidden" name="attr_stash_max" value="40"/>
  <input type="hidden" name="attr_playbook_xp_max" value="8"/>
  <input type="hidden" name="attr_rep_max" value="12"/>
  <input type="hidden" name="attr_changed_attributes" value=""/>
  <input type="hidden" name="attr_bonusdice" value="Bonus dice"/>
  <input type="hidden" name="attr_numberofdice" value=" {{?{Number of dice|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]}}}"/>
  <input type="hidden" name="attr_notes_query" value="?{Notes}"/>
  <input type="hidden" name="attr_position_query" value="?{Position|Risky,position=Risky|Controlled,position=Controlled|Desperate,position=Desperate|Fortune roll,short=short}"/>
  <input type="hidden" name="attr_effect_query" value="?{Effect|Standard|Limited|Great|Extreme|Zero}"/>
  <input type="hidden" name="attr_title_text" value=""/>
  <input type="hidden" name="attr_consequence_query" value="^{a_consequence}"/>
</div>
<input class="focus-shadow" type="hidden" name="attr_setting_focus_shadow" value="1"/>
<input class="show-broadcast" type="hidden" name="attr_setting_show_broadcast" value="1"/>
<input class="show-itemdesc" type="hidden" name="attr_setting_show_itemdesc" value="1"/>
<input class="show-frienddesc" type="hidden" name="attr_setting_show_frienddesc" value="1"/>
<input class="flexwidth" type="hidden" name="attr_setting_flexwidth" value="0"/>
<input class="clocks-only" type="hidden" name="attr_setting_clocks_only" value="0"/>
<input class="custom-action-toggle" type="hidden" name="attr_setting_custom_actions" value="0"/>
<div class="container">
  <input class="type" type="hidden" name="attr_sheet_type" value="character"/>
  <div class="topholder flex">
    <div class="type-selector label">
      <input class="hidden sheet-2waybox" type="checkbox" name="attr_sheet_type" value="mask"/>
      <input class="sheet-2waybox" type="radio" name="attr_sheet_type" value="character" checked="checked"/>
    </div>
    <label class="settings-checkbox">
      <input type="checkbox" name="attr_show_settings" value="1"/><span>y</span>
    </label>
  </div>
  <input class="hider" type="hidden" name="attr_show_settings" value="0"/>
  <div class="settings">
    <div class="setting-char generaterow">
      <label class="generatebutton">
        <input type="checkbox" name="attr_generate_ability" value="1"/><span data-i18n="add_abilities"></span>
      </label>
      <label class="generatebutton">
        <input type="checkbox" name="attr_generate_friend" value="1"/><span data-i18n="add_friends"></span>
      </label>
      <label class="generatebutton">
        <input type="checkbox" name="attr_generate_playbookitem" value="1"/><span data-i18n="add_items"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <select name="attr_setting_extra_stress">
          <option value="0" selected="selected">6</option>
          <option value="1">7</option>
          <option value="2">8</option>
          <option value="3">9</option>
        </select><span data-i18n="number_stress_boxes"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_extra_scars" value="1"/><span></span><span data-i18n="show_extra_scars_box"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_show_cohort" value="1"/><span></span><span data-i18n="show_cohort_section"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_show_frienddesc" value="1" checked="checked"/><span></span><span data-i18n="show_friend_contact_details"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input type="text" spellcheck="false" name="attr_setting_stress_label" value="Stress"/><span data-i18n="stress_label"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input type="text" spellcheck="false" name="attr_setting_scars_label" value="Scars"/><span data-i18n="scars_label"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input type="text" spellcheck="false" name="attr_setting_oath_label" value="Oaths"/><span data-i18n="oath_label"></span>
      </label>
    </div>
    <div class="setting-char"><span data-i18n="resistance_bonus"></span>
      <label>
        <input type="number" name="attr_setting_resbonus_insight" value="0"/><span data-i18n="insight"></span>
      </label>
      <label>
        <input type="number" name="attr_setting_resbonus_prowess" value="0"/><span data-i18n="prowess"></span>
      </label>
      <label>
        <input type="number" name="attr_setting_resbonus_resolve" value="0"/><span data-i18n="resolve"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_consequence_query" value="1"/><span></span><span data-i18n="query_for_consequence"></span>
      </label>
    </div>
    <div class="setting-char"><span data-i18n="load:"></span>
      <label>
        <input type="number" name="attr_setting_load_l" value="3"/><span data-i18n="light"></span>
      </label>
      <label>
        <input type="number" name="attr_setting_load_n" value="5"/><span data-i18n="normal"></span>
      </label>
      <label>
        <input type="number" name="attr_setting_load_h" value="6"/><span data-i18n="heavy"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_flexwidth" value="1"/><span></span><span data-i18n="flexible_width"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_focus_shadow" value="1" checked="checked"/><span></span><span data-i18n="show_outline"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_show_broadcast" value="1" checked="checked"/><span></span><span data-i18n="show_broadcast"></span>
      </label>
    </div>
    <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_autofill" value="1" checked="checked"/><span></span><span data-i18n="fill_fields"></span>
      </label>
    </div>
    <div class="setting-char custom-actions">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_custom_actions" value="1"/><span></span><span data-i18n="custom_action_labels"></span>
      </label>
      <div class="column">
        <input class="attribute-label" type="text" spellcheck="false" name="attr_insight_label" value="Insight"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_hunt_label" value="Hunt"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_study_label" value="Study"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_survey_label" value="Survey"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_tinker_label" value="Tinker"/>
      </div>
      <div class="column">
        <input class="attribute-label" type="text" spellcheck="false" name="attr_prowess_label" value="Prowess"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_finesse_label" value="Finesse"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_prowl_label" value="Prowl"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_skirmish_label" value="Skirmish"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_wreck_label" value="Wreck"/>
      </div>
      <div class="column">
        <input class="attribute-label" type="text" spellcheck="false" name="attr_resolve_label" value="Resolve"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_attune_label" value="Attune"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_command_label" value="Command"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_consort_label" value="Consort"/>
        <input class="action-label" type="text" spellcheck="false" name="attr_sway_label" value="Sway"/>
      </div>
    </div>
  </div>
  <div class="type-character grid">
    <div class="left-column grid">
      <div class="header grid sheet-2col">
        <div class="brinkwoodlogo"></div>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="name"></div>
        </label>
        <label>
          <input type="text" spellcheck="false" name="attr_alias"/>
          <div class="label text title" data-i18n="alias"></div>
        </label>
        <label>
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="pronouns"></div>
        </label>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="pact"></div>
        </label>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="look"></div>
        </label>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="tragedy"></div>
        </label>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="background"></div>
        </label>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="traits"></div>
        </label>
        <label class="sheet-2col">
          <input type="text" spellcheck="false" name="attr_name"/>
          <div class="label text title" data-i18n="bonds"></div>
        </label>
      </div>
      <div class="stress flex sheet-2col">
        <div class="stress1 blackheader">
          <div class="label"><span name="attr_setting_stress_label"></span></div>
        </div>
        <div class="stress2 blackborder flex">
          <input class="tooth zero" type="radio" name="attr_stress" value="0" checked="checked"/><span></span>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="1"/><span></span>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="2"/><span></span>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="3"/><span></span>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="4"/><span></span>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="5"/><span></span>
          <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="0" checked="checked"/>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="6"/><span></span>
          <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="1"/>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="7"/><span></span>
          <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="2"/>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="8"/><span></span>
          <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="3"/>
          <input class="tooth stresstooth" type="radio" name="attr_stress" value="9"/><span></span>
        </div>
        <div class="stress3">
          <div class="blackheader">
            <div class="label"><span name="attr_setting_scars_label"></span></div>
          </div>
          <div class="scarsholder flex">
            <input class="tooth zero" type="radio" name="attr_scars" value="0" checked="checked"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_scars" value="1"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_scars" value="2"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_scars" value="3"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_scars" value="4"/><span></span>
          </div>
        </div>
        <div class="stress3">
          <div class="blackheader">
            <div class="label"><span name="attr_setting_oath_label"></span></div>
          </div>
          <div class="scarsholder flex">
            <input class="tooth zero" type="radio" name="attr_oath" value="0" checked="checked"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_oath" value="1"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_oath" value="2"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_oath" value="3"/><span></span>
            <input class="tooth regulartooth" type="radio" name="attr_oath" value="4"/><span></span>
          </div>
        </div>
      </div>
      <div class="bans-coin grid">
        <div class="bans">
          <div class="blackheader">
            <div class="label" data-i18n="bans"></div>
            <button class="broadcast-button" type="roll" name="roll_Bans" value="&amp;{template:bitd-broadcast} {{charname=@{character_name}}} {{bans=1}} {{bans3=@{bans3}}} {{bans2_1=@{bans2_1}}} {{bans2_2=@{bans2_2}}} {{bans1_1=@{bans1_1}}} {{bans1_2=@{bans1_2}}} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="send_details_to_chat">:</button>
          </div>
          <div class="bansbody">
            <div class="flex-center bansnumber">3</div>
            <textarea class="2col" spellcheck="false" name="attr_bans3"></textarea>
            <div class="flex-center banseffect" data-i18n="bans3_desc"></div>
            <div class="flex-center bansnumber">2</div>
            <textarea spellcheck="false" name="attr_bans2_1"></textarea>
            <textarea spellcheck="false" name="attr_bans2_2"></textarea>
            <div class="flex-center banseffect" data-i18n="bans2_desc"></div>
            <div class="flex-center bansnumber">1</div>
            <textarea spellcheck="false" name="attr_bans1_1"></textarea>
            <textarea spellcheck="false" name="attr_bans1_2"></textarea>
            <div class="flex-center banseffect" data-i18n="bans1_desc"></div>
          </div>
        </div>
      </div>
      <div class="advancement sheet-2col">
        <div class="advancement-header flex blackheader">
          <div class="label markxp" data-i18n="mark_xp:"></div>
          <div class="label" data-i18n="advancement"></div>
          <div class="xpholder flex">
            <input class="tooth zero" type="radio" name="attr_playbook_xp" value="0" checked="checked"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="1"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="2"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="3"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="4"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="5"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="6"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="7"/><span></span>
            <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="8"/><span></span>
          </div>
        </div>
        <ul class="advancement-desc">
          <li data-i18n="xp_desperate"></li>
          <li class="nondot" data-i18n="xp_top"></li>
          <li data-i18n="xp_beliefs"></li>
          <li data-i18n="xp_vice"></li>
          <li data-i18n="xp_relationship"></li>
        </ul>
      </div>
      <div class="teamwork">
        <div class="plainheader label" data-i18n="teamwork"></div>
        <div class="teamworkbox" data-i18n="assist_a_teammate"></div>
        <div class="teamworkbox" data-i18n="lead_a_group_action"></div>
        <div class="teamworkbox" data-i18n="protect_a_teammate"></div>
        <div class="teamworkbox" data-i18n="set_up_a_teammate"></div>
      </div>
      <div class="gatherinfo">
        <div class="plainheader label" data-i18n="gather_information"></div>
        <div>
          <ul>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo1" data-i18n-placeholder="gatherinfo_what_do_they_intend"/>
            </li>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo2" data-i18n-placeholder="gatherinfo_how_can_I_get_them"/>
            </li>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo3" data-i18n-placeholder="gatherinfo_what_are_they_really"/>
            </li>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo4" data-i18n-placeholder="gatherinfo_what_should_I_look"/>
            </li>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo5" data-i18n-placeholder="gatherinfo_wheres_the_weakness"/>
            </li>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo6" data-i18n-placeholder="gatherinfo_how_can_I_find"/>
            </li>
            <li>
              <input class="inherit" type="text" spellcheck="false" name="attr_gatherinfo7" data-i18n-placeholder="gatherinfo_whats_going_on"/>
            </li>
          </ul>
        </div>
        <input class="hider" type="hidden" name="attr_setting_show_strictures" value="0"/>
        <div class="strictures def-margin">
          <div class="plainheader label" data-i18n="strictures"></div>
          <div><span class="italic" data-i18n="stricturesblurb"></span></div>
          <div>
            <label>
              <input class="checkbox squarebox" type="checkbox" name="attr_stricture_slumber" value="1"/><span></span><span class="label" data-i18n="slumber"></span>
            </label><span data-i18n="strictures_slumber"></span>
          </div>
          <div>
            <label>
              <input class="checkbox squarebox" type="checkbox" name="attr_stricture_forbidden" value="1"/><span></span><span class="label" data-i18n="forbidden"></span>
            </label><span data-i18n="strictures_forbidden"></span>
          </div>
          <div>
            <label>
              <input class="checkbox squarebox" type="checkbox" name="attr_stricture_repelled" value="1"/><span></span><span class="label" data-i18n="repelled"></span>
            </label><span data-i18n="strictures_repelled"></span>
          </div>
          <div>
            <label>
              <input class="checkbox squarebox" type="checkbox" name="attr_stricture_bestial" value="1"/><span></span><span class="label" data-i18n="bestial"></span>
            </label><span data-i18n="strictures_bestial"></span>
          </div>
          <div>
            <label>
              <input class="checkbox squarebox" type="checkbox" name="attr_stricture_bound" value="1"/><span></span><span class="label" data-i18n="bound"></span>
            </label><span data-i18n="strictures_bound"></span>
          </div>
        </div>
      </div>
      <textarea class="notes sheet-2col small-margin" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
    </div>
    <div class="right-column grid">
      <div class="itemcolumn">
        <div class="loadheader flex">
          <div class="label" data-i18n="load"></div>
          <label>
            <input class="checkbox" type="checkbox" name="attr_load" value="light"/><span></span><span class="loadnumber" name="attr_setting_load_l"></span><span data-i18n="light"></span>
          </label>
          <label>
            <input class="checkbox" type="checkbox" name="attr_load" value="normal"/><span></span><span class="loadnumber" name="attr_setting_load_n"></span><span data-i18n="normal"></span>
          </label>
          <label>
            <input class="checkbox" type="checkbox" name="attr_load" value="heavy"/><span></span><span class="loadnumber" name="attr_setting_load_h"></span><span data-i18n="heavy"></span>
          </label>
        </div>
        <div class="itemheader small-margin flex">
          <div class="label" data-i18n="items"></div>
          <label class="text-button">
            <input type="checkbox" name="attr_reset_items" value="1"/><span data-i18n="reset?"></span>
          </label>
        </div>
        <div class="itemholder items">
          <div class="playbookitems free-repcontrol">
            <fieldset class="repeating_playbookitem">
              <input class="boxes-chosen" type="hidden" name="attr_boxes_chosen" value="0"/>
              <div class="item numboxes-chooser">
                <div data-i18n="how_much_load"></div>
                <input type="number" name="attr_numboxes" min="0" max="3" value="0"/>
                <label>
                  <input type="checkbox" name="attr_bold" value="1"/><span data-i18n="bold"></span>
                </label>
                <label>
                  <input type="checkbox" name="attr_boxes_chosen" value="1"/><span data-i18n="ok"></span>
                </label>
              </div>
              <div class="item">
                <input class="input-bold" type="hidden" name="attr_bold" value="0"/>
                <input class="numboxes" type="hidden" name="attr_numboxes" value="0"/>
                <input class="checkbox squarebox" type="checkbox" name="attr_check_1" value="1"/><span></span><span class="floatingbar boxesgeq2"></span>
                <input class="checkbox squarebox boxesgeq2" type="checkbox" name="attr_check_2" value="1"/><span class="boxesgeq2"></span><span class="floatingbar boxesgeq3 boxesgeq2"></span>
                <input class="checkbox squarebox boxesgeq2 boxesgeq3" type="checkbox" name="attr_check_3" value="1"/><span class="boxesgeq2 boxesgeq3"></span>
                <div class="auto-expand itemname"><span name="attr_name"></span>
                  <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="item_name"></textarea>
                </div>
              </div>
              <div class="item-description">
                <input class="expand" type="checkbox" value="1"/><span></span>
                <textarea spellcheck="false" name="attr_description" data-i18n-placeholder="description"></textarea>
              </div>
            </fieldset>
            <input class="hider" type="hidden" name="attr_setting_show_frame" value="0"/>
            <div class="frame small-margin">
              <input class="smallcaps" type="text" spellcheck="false" name="attr_frame" value="Frame"/>
              <textarea spellcheck="false" name="attr_frame_description" data-i18n-placeholder="frame_description"></textarea>
              <fieldset class="repeating_framefeature">
                <div class="item">
                  <input class="checkbox circlebox" type="checkbox" name="attr_check" value="1"/><span></span>
                  <input class="itemname" type="text" spellcheck="false" name="attr_name" data-i18n-placeholder="frame_feature"/>
                </div>
              </fieldset>
            </div>
          </div>
          <div class="regularitems free-repcontrol">
            <fieldset class="repeating_item">
              <input class="input-short" type="hidden" name="attr_short" value="0"/>
              <input class="input-expand" type="hidden" name="attr_expand" value="0"/>
              <div class="item-container">
                <input class="boxes-chosen" type="hidden" name="attr_boxes_chosen" value="0"/>
                <div class="item numboxes-chooser">
                  <div data-i18n="how_much_load"></div>
                  <input type="number" name="attr_numboxes" min="0" max="3" value="0"/>
                  <label>
                    <input type="checkbox" name="attr_short" value="1"/><span data-i18n="short"></span>
                  </label>
                  <label>
                    <input type="checkbox" name="attr_boxes_chosen" value="1"/><span data-i18n="ok"></span>
                  </label>
                </div>
                <div class="item">
                  <input class="numboxes" type="hidden" name="attr_numboxes" value="0"/>
                  <input class="checkbox squarebox" type="checkbox" name="attr_check_1" value="1"/><span></span><span class="floatingbar boxesgeq2"></span>
                  <input class="checkbox squarebox boxesgeq2" type="checkbox" name="attr_check_2" value="1"/><span class="boxesgeq2"></span><span class="floatingbar boxesgeq3 boxesgeq2"></span>
                  <input class="checkbox squarebox boxesgeq2 boxesgeq3" type="checkbox" name="attr_check_3" value="1"/><span class="boxesgeq2 boxesgeq3"></span>
                  <input class="itemname" type="text" spellcheck="false" name="attr_name" data-i18n-placeholder="item_name"/>
                </div>
                <div class="item-description">
                  <input class="expand" type="checkbox" name="attr_expand" value="1"/><span></span>
                  <textarea spellcheck="false" name="attr_description" data-i18n-placeholder="description"></textarea>
                </div>
              </div>
            </fieldset>
          </div>
        </div>
      </div>
      <div class="actioncolumn">
        <div class="attribute">
          <div class="attribute-title flex">
            <button class="rollbutton label" type="roll" name="roll_Insight" value="&{template:brinkwood} {{charname=@{character_name}}} {{type=resist}} {{subtitle=^{resists} @{consequence_query} ^{with}}} {{title-insight=1}} {{title=^{insight}}} @{insight_formula} {{instructions=^{resist_instructions}}} @{insight_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="insight_description"><span class="default-label inherit" data-i18n="insight"></span><span class="custom-label inherit" name="attr_insight_label"></span>
            </button>
            <input type="hidden" name="attr_insight" value="0"/>
            <input type="hidden" name="attr_insight_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
            <input type="hidden" name="attr_insight_xp_max" value="0"/>
            <input type="hidden" name="attr_insight_roll_mods" value=""/>
          </div>
          <div class="actions">
            <div class="action flex">
              <input type="hidden" name="attr_hunt_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_hunt_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_insight" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_hunt" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Hunt" value="&{template:brinkwood} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-hunt=1}} {{title=^{hunt}}} {{@{position_query}}} {{effect=@{effect_query}}} @{hunt_formula} @{hunt_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="hunt_description"><span class="default-label inherit" data-i18n="hunt"></span><span class="custom-label inherit" name="attr_hunt_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_study_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_study_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_insight" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_study" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Study" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-study=1}} {{title=^{study}}} {{@{position_query}}} {{effect=@{effect_query}}} @{study_formula} @{study_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="study_description"><span class="default-label inherit" data-i18n="study"></span><span class="custom-label inherit" name="attr_study_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_survey_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_survey_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_insight" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_survey" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Survey" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-survey=1}} {{title=^{survey}}} {{@{position_query}}} {{effect=@{effect_query}}} @{survey_formula} @{survey_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="survey_description"><span class="default-label inherit" data-i18n="survey"></span><span class="custom-label inherit" name="attr_survey_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_tinker_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_tinker_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_insight" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_tinker" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Tinker" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-tinker=1}} {{title=^{tinker}}} {{@{position_query}}} {{effect=@{effect_query}}} @{tinker_formula} @{tinker_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="tinker_description"><span class="default-label inherit" data-i18n="tinker"></span><span class="custom-label inherit" name="attr_tinker_label"></span>
              </button>
            </div>
          </div>
        </div>
        <div class="attribute">
          <div class="attribute-title flex">
            <button class="rollbutton label" type="roll" name="roll_Prowess" value="&{template:blades} {{charname=@{character_name}}} {{type=resist}} {{subtitle=^{resists} @{consequence_query} ^{with}}} {{title-prowess=1}} {{title=^{prowess}}} @{prowess_formula} {{instructions=^{resist_instructions}}} @{prowess_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="prowess_description"><span class="default-label inherit" data-i18n="prowess"></span><span class="custom-label inherit" name="attr_prowess_label"></span>
            </button>
            <input type="hidden" name="attr_prowess" value="0"/>
            <input type="hidden" name="attr_prowess_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
            <input type="hidden" name="attr_prowess_xp_max" value="0"/>
            <input type="hidden" name="attr_prowess_roll_mods" value=""/>
          </div>
          <div class="actions">
            <div class="action flex">
              <input type="hidden" name="attr_finesse_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_finesse_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_prowess" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_finesse" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Finesse" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-finesse=1}} {{title=^{finesse}}} {{@{position_query}}} {{effect=@{effect_query}}} @{finesse_formula} @{finesse_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="finesse_description"><span class="default-label inherit" data-i18n="finesse"></span><span class="custom-label inherit" name="attr_finesse_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_prowl_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_prowl_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_prowess" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_prowl" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Prowl" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-prowl=1}} {{title=^{prowl}}} {{@{position_query}}} {{effect=@{effect_query}}} @{prowl_formula} @{prowl_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="prowl_description"><span class="default-label inherit" data-i18n="prowl"></span><span class="custom-label inherit" name="attr_prowl_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_skirmish_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_skirmish_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_prowess" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_skirmish" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Skirmish" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-skirmish=1}} {{title=^{skirmish}}} {{@{position_query}}} {{effect=@{effect_query}}} @{skirmish_formula} @{skirmish_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="skirmish_description"><span class="default-label inherit" data-i18n="skirmish"></span><span class="custom-label inherit" name="attr_skirmish_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_wreck_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_wreck_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_prowess" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_wreck" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Wreck" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-wreck=1}} {{title=^{wreck}}} {{@{position_query}}} {{effect=@{effect_query}}} @{wreck_formula} @{wreck_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="wreck_description"><span class="default-label inherit" data-i18n="wreck"></span><span class="custom-label inherit" name="attr_wreck_label"></span>
              </button>
            </div>
          </div>
        </div>
        <div class="attribute">
          <div class="attribute-title flex">
            <button class="rollbutton label" type="roll" name="roll_Resolve" value="&{template:blades} {{charname=@{character_name}}} {{type=resist}} {{subtitle=^{resists} @{consequence_query} ^{with}}} {{title-resolve=1}} {{title=^{resolve}}} @{resolve_formula} {{instructions=^{resist_instructions}}} @{resolve_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="resolve_description"><span class="default-label inherit" data-i18n="resolve"></span><span class="custom-label inherit" name="attr_resolve_label"></span>
            </button>
            <input type="hidden" name="attr_resolve" value="0"/>
            <input type="hidden" name="attr_resolve_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
            <input type="hidden" name="attr_resolve_xp_max" value="0"/>
            <input type="hidden" name="attr_resolve_roll_mods" value=""/>
          </div>
          <div class="actions">
            <div class="action flex">
              <input type="hidden" name="attr_attune_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_attune_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_resolve" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_attune" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Attune" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-attune=1}} {{title=^{attune}}} {{@{position_query}}} {{effect=@{effect_query}}} @{attune_formula} @{attune_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="attune_description"><span class="default-label inherit" data-i18n="attune"></span><span class="custom-label inherit" name="attr_attune_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_command_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_command_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_resolve" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_command" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Command" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-command=1}} {{title=^{command}}} {{@{position_query}}} {{effect=@{effect_query}}} @{command_formula} @{command_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="command_description"><span class="default-label inherit" data-i18n="command"></span><span class="custom-label inherit" name="attr_command_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_consort_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_consort_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_resolve" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_consort" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Consort" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-consort=1}} {{title=^{consort}}} {{@{position_query}}} {{effect=@{effect_query}}} @{consort_formula} @{consort_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="consort_description"><span class="default-label inherit" data-i18n="consort"></span><span class="custom-label inherit" name="attr_consort_label"></span>
              </button>
            </div>
            <div class="action flex">
              <input type="hidden" name="attr_sway_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
              <input type="hidden" name="attr_sway_roll_mods" value=""/>
              <input class="darktalent" type="hidden" name="attr_setting_dark_talent_resolve" value="0"/>
              <input class="hidden fakeradio" type="checkbox" name="attr_sway" value="0" checked="checked"/>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="1"/><span></span>
              <div class="divider"></div>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="2"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="3"/><span></span>
              <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="4"/><span></span>
              <button class="rollbutton label" type="roll" name="roll_Sway" value="&{template:blades} {{charname=@{character_name}}} {{type=action}} {{subtitle=^{rolls}}} {{title-sway=1}} {{title=^{sway}}} {{@{position_query}}} {{effect=@{effect_query}}} @{sway_formula} @{sway_roll_mods} {{charimage=@{chat_image}}} @{title_text}" data-i18n-title="sway_description"><span class="default-label inherit" data-i18n="sway"></span><span class="custom-label inherit" name="attr_sway_label"></span>
              </button>
            </div>
          </div>
        </div>
        <input class="hider" type="hidden" name="attr_setting_show_cohort" value="0"/>
        <div class="cohort">
          <input type="hidden" name="attr_char_cohort_verb" value="^{rolls_their}"/>
          <input type="hidden" name="attr_char_cohort_roll_formula" value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}"/>
          <div class="cohort-title flex label">
            <input class="inherit" type="text" spellcheck="false" name="attr_char_cohort_name" value="Cohort"/>
            <button class="inherit rollbutton" type="roll" name="roll_char_cohort_roll" value="&{template:blades} {{charname=@{character_name}}} {{type=resist}} {{short=short}} {{charname=@{char_cohort_name} (^{@{char_cohort_type}}, @{char_cohort_subtype})}} {{title-cohort_quality=1}} {{title=^{cohort_quality}}} {{subtitle=@{char_cohort_verb}}} @{char_cohort_roll_formula} {{charimage=@{chat_image}}} @{title_text}" data-i18n="roll-inf">
            </button>
          </div>
          <div class="cohort-info flex uppercase">
            <div class="cohort-dropdown">
              <div><span name="attr_char_cohort_type" data-i18n-dynamic="data-i18n-dynamic"></span></div>
              <div>
                <input type="radio" name="attr_char_cohort_type" value="gang"/><span data-i18n="gang"></span>
              </div>
              <div>
                <input type="radio" name="attr_char_cohort_type" value="elite"/><span data-i18n="elite"></span>
              </div>
              <div>
                <input type="radio" name="attr_char_cohort_type" value="expert" checked="checked"/><span data-i18n="expert"></span>
              </div>
            </div>
            <input class="sheet-inherit" type="text" spellcheck="false" name="attr_char_cohort_subtype" data-i18n-placeholder="hunter"/>
            <div class="label cohort-quality-label" data-i18n="quality_abbreviated">Q:</div>
            <input class="label" type="number" name="attr_char_cohort_quality" min="0" max="5" value="1"/>
          </div>
          <div class="cohort-condition flex">
            <label><span class="cohort-condition-name uppercase" data-i18n="weak"></span>
              <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_weak" value="1"/><span></span>
            </label>
            <label><span class="cohort-condition-name uppercase" data-i18n="impaired"></span>
              <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_impaired" value="1"/><span></span>
            </label>
            <label><span class="cohort-condition-name uppercase" data-i18n="broken"></span>
              <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_broken" value="1"/><span></span>
            </label>
            <label><span class="cohort-condition-name label" data-i18n="armor"></span>
              <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_armor" value="1"/><span></span>
            </label>
          </div>
          <label class="cohort-edgeflaw"><span class="uppercase" data-i18n="edges"></span>
            <div class="auto-expand"><span name="attr_char_cohort_edges"></span>
              <textarea spellcheck="false" name="attr_char_cohort_edges"></textarea>
            </div>
          </label>
          <label class="cohort-edgeflaw"><span class="uppercase" data-i18n="flaws"></span>
            <div class="auto-expand"><span name="attr_char_cohort_flaws"></span>
              <textarea spellcheck="false" name="attr_char_cohort_flaws"></textarea>
            </div>
          </label>
          <textarea class="cohort-description" spellcheck="false" name="attr_char_cohort_description"></textarea>
        </div>
        <div class="bonusdie">
          <div class="label" data-i18n="bonus_die"></div>
          <div class="flex">
            <div class="flex-center bonusdieplus">+</div>
            <div class="bonusdietext">
              <div class="label" data-i18n="push_yourself"></div><span data-i18n="push_yourself_desc1"></span><span name="attr_setting_stress_label"></span><span data-i18n="push_yourself_desc2"></span>
              <div class="label" data-i18n="devils_bargain"></div>
            </div>
          </div>
        </div>
        <div class="friends">
          <div class="specialheader label flex">
            <input class="inherit" type="text" spellcheck="false" name="attr_friends_title" value="Friends"/>
          </div>
          <div class="greyholder">
            <fieldset class="repeating_friend">
              <div class="friend-contact friend flex">
                <input class="friendstate" type="hidden" name="attr_status" value="0"/>
                <label class="up">
                  <input class="checkbox" type="checkbox" name="attr_status" value="up"/><span></span>
                </label>
                <label class="down">
                  <input class="checkbox" type="checkbox" name="attr_status" value="down"/><span></span>
                </label>
                <div class="auto-expand"><span name="attr_name"></span>
                  <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="friend_name"></textarea>
                </div>
              </div>
              <input class="expand" type="checkbox" value="1"/><span></span>
              <textarea class="description" spellcheck="false" name="attr_description" data-i18n-placeholder="notes"></textarea>
            </fieldset>
          </div>
        </div>
        <button class="fortunebutton borderbutton" type="roll" name="roll_Fortune" value="&{template:blades} {{charname=@{character_name}}} {{type=fortune}} {{subtitle=^{rolls}}} {{title-fortune=1}} {{title=^{fortune}}} @{numberofdice} {{notes=@{notes_query}}} {{charimage=@{chat_image}}} @{title_text}" data-i18n="roll_fortune"></button>
      </div>
      <div class="clocks sheet-2col free-repcontrol">
        <div class="specialheader label" data-i18n="clocks"></div>
        <fieldset class="repeating_clock">
          <input class="size" type="hidden" name="attr_size" value=""/>
          <div class="auto-expand smallcaps"><span name="attr_name"></span>
            <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="clock_name"></textarea>
          </div>
          <button class="broadcast-button" type="roll" name="roll_Show" value="&amp;{template:bitd-broadcast}{{charname=@{character_name}}} {{title=@{name}}} {{clock=1}} {{clocksize=@{size}}} {{clockprogress=@{progress}}} {{charimage=@{chat_image}}}" data-i18n-title="send_details_to_chat">:</button>
          <div class="size-choice">
            <label class="text-button">
              <input type="radio" name="attr_size" value="4"/><span>4</span>
            </label>
            <label class="text-button">
              <input type="radio" name="attr_size" value="6"/><span>6</span>
            </label>
            <label class="text-button">
              <input type="radio" name="attr_size" value="8"/><span>8</span>
            </label>
            <label class="text-button">
              <input type="radio" name="attr_size" value="10"/><span>10</span>
            </label>
            <label class="text-button">
              <input type="radio" name="attr_size" value="12"/><span>12</span>
            </label>
          </div>
          <div class="clock-container">
            <div class="spoke-0 all"></div>
            <div class="spoke-30 sheet-12clock"></div>
            <div class="spoke-45 sheet-8clock"></div>
            <div class="spoke-36 sheet-10clock"></div>
            <div class="spoke-60 sheet-6clock sheet-12clock"></div>
            <div class="spoke-72 sheet-10clock"></div>
            <div class="spoke-90 sheet-4clock sheet-8clock sheet-12clock"></div>
            <div class="spoke-108 sheet-10clock"></div>
            <div class="spoke-120 sheet-6clock sheet-12clock"></div>
            <div class="spoke-135 sheet-8clock"></div>
            <div class="spoke-144 sheet-10clock"></div>
            <div class="spoke-150 sheet-12clock"></div>
            <input class="zero input-progress" type="radio" name="attr_progress" value="0" checked="checked"/><span></span>
            <input class="input-progress all" type="radio" name="attr_progress" value="1"/>
            <input class="input-progress all" type="radio" name="attr_progress" value="2"/>
            <input class="input-progress all" type="radio" name="attr_progress" value="3"/>
            <input class="input-progress all" type="radio" name="attr_progress" value="4"/>
            <input class="input-progress sheet-6clock sheet-8clock sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="5"/>
            <input class="input-progress sheet-6clock sheet-8clock sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="6"/>
            <input class="input-progress sheet-8clock sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="7"/>
            <input class="input-progress sheet-8clock sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="8"/>
            <input class="input-progress sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="9"/>
            <input class="input-progress sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="10"/>
            <input class="input-progress sheet-12clock" type="radio" name="attr_progress" value="11"/>
            <input class="input-progress sheet-12clock" type="radio" name="attr_progress" value="12"/>
            <div class="clock"></div>
          </div>
        </fieldset>
      </div>
      <div class="planning sheet-2col def-margin">
          <input class="title-checkbox" type="checkbox" name="attr_show_planning" value="1" checked="checked"/><span class="label plainheader" data-i18n="planning_load"></span>
          <div class="planning-content">
            <div class="planningdesc" data-i18n="planningdesc"></div>
            <div class="teamworkbox"><span class="bold" data-i18n="dramatic"></span><span class="italic" data-i18n="detail_dramatic"></span></div>
            <div class="teamworkbox"><span class="bold" data-i18n="subtle"></span><span class="italic" data-i18n="detail_subtle"></span></div>
            <div class="teamworkbox"><span class="bold" data-i18n="tactical"></span><span class="italic" data-i18n="detail_tactical"></span></div>
            <div class="teamworkbox"><span class="bold" data-i18n="rapid"></span><span class="italic" data-i18n="detail_rapid"></span></div>
            <div class="teamworkbox"><span class="bold" data-i18n="cautious"></span><span class="italic" data-i18n="detail_cautious"></span></div>
            <div class="teamworkbox"><span class="bold" data-i18n="charismatic"></span><span class="italic" data-i18n="detail_charismatic"></span></div>
          </div>
        </div>
    </div>
  </div>
</div>
<rolltemplate class="sheet-rolltemplate-blades">
  <div class="holder {{type}} {{short}} {{language}}">{{#charimage}}
    <div class="char-image">[Image]({{charimage}})</div>{{/charimage}}
    <div class="header{{#charimage}} narrow{{/charimage}}">{{charname}} {{subtitle}}</div>
    <div class="title">{{#title-text}}<span class="{{small-title}}">{{title}}</span>{{/title-text}}{{^title-text}}{{#rolltypetext}}[{{rolltypetext}}]({{rolltypeimage}}){{/rolltypetext}}{{#title-insight}}<img data-i18n-alt="insight" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-insight.png"/>{{/title-insight}}{{#title-prowess}}<img data-i18n-alt="prowess" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-prowess.png"/>{{/title-prowess}}{{#title-resolve}}<img data-i18n-alt="resolve" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-resolve.png"/>{{/title-resolve}}{{#title-hunt}}<img data-i18n-alt="hunt" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-hunt.png"/>{{/title-hunt}}{{#title-study}}<img data-i18n-alt="study" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-study.png"/>{{/title-study}}{{#title-survey}}<img data-i18n-alt="survey" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-survey.png"/>{{/title-survey}}{{#title-tinker}}<img data-i18n-alt="tinker" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-tinker.png"/>{{/title-tinker}}{{#title-finesse}}<img data-i18n-alt="finesse" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-finesse.png"/>{{/title-finesse}}{{#title-prowl}}<img data-i18n-alt="prowl" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-prowl.png"/>{{/title-prowl}}{{#title-skirmish}}<img data-i18n-alt="skirmish" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-skirmish.png"/>{{/title-skirmish}}{{#title-wreck}}<img data-i18n-alt="wreck" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-wreck.png"/>{{/title-wreck}}{{#title-attune}}<img data-i18n-alt="attune" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-attune.png"/>{{/title-attune}}{{#title-command}}<img data-i18n-alt="command" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-command.png"/>{{/title-command}}{{#title-consort}}<img data-i18n-alt="consort" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-consort.png"/>{{/title-consort}}{{#title-sway}}<img data-i18n-alt="sway" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-sway.png"/>{{/title-sway}}{{#title-fortune}}<img data-i18n-alt="fortune" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-fortune.png"/>{{/title-fortune}}{{#title-vice}}<img data-i18n-alt="vice" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-vice.png"/>{{/title-vice}}{{#title-crew_tier}}<img data-i18n-alt="crew_tier" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-crew_tier.png"/>{{/title-crew_tier}}{{#title-entanglement}}<img data-i18n-alt="entanglement" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-entanglement.png"/>{{/title-entanglement}}{{#title-cohort_quality}}<img data-i18n-alt="cohort_quality" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-cohort_quality.png"/>{{/title-cohort_quality}}{{#title-lifestyle}}<img data-i18n-alt="lifestyle" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-lifestyle.png"/>{{/title-lifestyle}}{{#title-recovery}}<img data-i18n-alt="recovery" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-recovery.png"/>{{/title-recovery}}{{#title-engagement}}<img data-i18n-alt="engagement" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-engagement.png"/>{{/title-engagement}}{{/title-text}}
    </div>
    <div class="dice">{{^zerodice}}{{dice}}{{/zerodice}}{{#zerodice}}
      <div class="zerodice1">{{zerodice}}</div>
      <div class="zerodice2" data-i18n="zerodice"></div>{{/zerodice}}
    </div>{{#position}}
    <div class="position">{{position}}</div>{{/position}}{{#effect}}
    <div class="effect">{{effect}}</div>{{/effect}}{{#instructions}}
    <div class="instructions">{{instructions}}</div>{{/instructions}}{{#notes}}
    <div class="notes">{{notes}}</div>{{/notes}}
  </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-bitd-broadcast">
  <div class="{{#korean}}korean{{/korean}}">{{#charimage}}{{^clock}}
    <div class="char-image">[Image]({{charimage}})</div>{{/clock}}{{/charimage}}
    <div class="header{{#charimage}}{{^clock}} narrow{{/clock}}{{/charimage}}">
      <div>{{charname}}</div>
      <div>{{type}}</div>
    </div>{{#content}}
    <div class="title">{{title}}</div>
    <div class="content">{{content}}</div>{{/content}}{{#clock}}
    <div class="flex">
      <div class="clock size-{{clocksize}} progress-{{clockprogress}}">
        <div class="spoke-0"></div>
        <div class="spoke-30"></div>
        <div class="spoke-36"></div>
        <div class="spoke-45"></div>
        <div class="spoke-60"></div>
        <div class="spoke-72"></div>
        <div class="spoke-90"></div>
        <div class="spoke-108"></div>
        <div class="spoke-135"></div>
        <div class="spoke-144"></div>
        <div class="spoke-120"></div>
        <div class="spoke-150"></div>
      </div>
      <div class="title">{{title}}</div>
    </div>{{/clock}}{{#bans}}{{#title-text}}
    <div class="title" data-i18n="bans"></div>{{/title-text}}{{^title-text}}
    <div class="title"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/rolltemplate/rolltemplate-title-harm.png"/></div>{{/title-text}}
    <table class="bans">
      <tr>
        <td>3</td>
        <td>
          <div class="bans-inner">{{bans3}}</div>
        </td>
        <td data-i18n="need_help"></td>
      </tr>
      <tr>
        <td>2</td>
        <td>{{#bans2_1}}
          <div class="bans-inner">{{bans2_1}}</div>{{/bans2_1}}{{#bans2_2}}
          <div class="bans-inner">{{bans2_2}}</div>{{/bans2_2}}
        </td>
        <td data-i18n="minus1d"></td>
      </tr>
      <tr>
        <td>1</td>
        <td>{{#bans1_1}}
          <div class="bans-inner">{{bans1_1}}</div>{{/bans1_1}}{{#bans1_2}}
          <div class="bans-inner">{{bans1_2}}</div>{{/bans1_2}}
        </td>
        <td data-i18n="less_effect"></td>
      </tr>
    </table>{{/bans}}
  </div>
</rolltemplate>
<script type="text/worker">(function () {
/* global on, setAttrs, getAttrs, getSectionIDs, getTranslationByKey,
  getTranslationLanguage, generateRowID, removeRepeatingRow */
(function () {
  "use strict";
  /* FUNCTIONS */
  function dataSetup() {
    Object.keys(crewData).forEach(crew => {
      const base = crewData[crew].base,
        translatedBaseAttributes = [
          ...[...Array(16).keys()].slice(1).map(i => `claim_${i}_name`),
          ...[...Array(16).keys()].slice(1).map(i => `claim_${i}_desc`),
          "cohort1_description",
          "cohort1_name",
          "cohort1_subtype",
          "crew_description",
          "crew_xp_condition",
          "hunting_grounds_type",
          "hunting_grounds_description",
          "upgrade_carriage_name",
          "upgrade_boat_name"
        ];
      Object.keys(base).forEach(attr => {
        if (translatedBaseAttributes.includes(attr)) {
          base[attr] = getTranslationByKey(base[attr]);
        }
      });
      crewData[crew].contact = [...Array(6).keys()].map(i => ({
        name: getTranslationByKey(`crew_${crew}_contact_${i}`)
      }));
      crewData[crew].crewability = crewData[crew].crewability.map(name => ({
        name: getTranslationByKey(`crew_ability_${name}`),
        description: getTranslationByKey(`crew_ability_${name}_description`)
      }));
      crewData[crew].upgrade.forEach(upgrade => {
        upgrade.name = getTranslationByKey(upgrade.name);
        upgrade.boxes_chosen = "1";
      });
    });
    itemData.forEach(item => {
      item.boxes_chosen = "1";
      item.name = getTranslationByKey(item.name);
      item.description = getTranslationByKey(item.description);
    });
    Object.keys(translatedDefaults).forEach(k => {
      translatedDefaults[k] = getTranslationByKey(translatedDefaults[k]);
    });
    Object.assign(defaultValues, translatedDefaults);
    Object.keys(factionsData).forEach(x => {
      factionsData[x].forEach(faction => {
        faction.name = getTranslationByKey(faction.name);
      });
    });
    alchemicalData.forEach((v, k) => {
      alchemicalData[k] = {
        name: getTranslationByKey(v)
      };
    });
    Object.keys(playbookData).forEach(playbook => {
      const base = playbookData[playbook].base,
        translatedBaseAttributes = [
          "char_cohort_name",
          "char_cohort_subtype",
          "friends_title",
          "gatherinfo1",
          "gatherinfo2",
          "gatherinfo3",
          "gatherinfo4",
          "gatherinfo5",
          "gatherinfo6",
          "playbook_description",
          "setting_stress_label",
          "setting_scars_label",
          "special_abilities_title",
          "xp_condition",
          "xp_condition2",
          "xp_condition3"
        ];
      Object.keys(base).forEach(attr => {
        if (translatedBaseAttributes.includes(attr)) {
          base[attr] = getTranslationByKey(base[attr]);
        }
      });
      if (!["ghost", "hull"].includes(playbook)) {
        playbookData[playbook].friend = [...Array(5).keys()]
          .map(i => ({
            name: getTranslationByKey(`playbook_${playbook}_friend_${i}`)
          }))
          .filter(o => o.name);
      } else playbookData[playbook].friend = [];
      playbookData[playbook].ability = playbookData[playbook].ability
        .map(name => ({
          name: getTranslationByKey(`playbook_ability_${name}`),
          description:
            getTranslationByKey(`playbook_ability_${name}_description`)
        }));
      if (spiritPlaybooks.includes(playbook)) {
        playbookData[playbook].ability[0].check = "1";
      }
      playbookData[playbook].playbookitem.forEach(item => {
        item.name = getTranslationByKey(item.name);
        item.boxes_chosen = "1";
      });
    });
    const playbookAbilityMap = new Map([
      ...Object.values(playbookData).map(x => x.ability).reduce((m, v) => {
        v.forEach(a => m.add(a));
        return m;
      }, new Set())].map(x => {
      return [x.name.toLowerCase(), x.description];
    }));
    const crewAbilityMap = new Map([
      ...Object.values(crewData).map(x => x.crewability).reduce((m, v) => {
        v.forEach(a => m.add(a));
        return m;
      }, new Set())].map(x => {
      return [x.name.toLowerCase(), x.description];
    }));
    [
      crewData, playbookData, factionsData, actionData, scarsData, itemData,
      translatedDefaults, defaultValues, spiritPlaybooks, alchemicalData,
    ].forEach(x => Object.freeze(x));
    return [playbookAbilityMap, crewAbilityMap];
  }
  function mySetAttrs(attrs, options, callback) {
    const finalAttrs = Object.keys(attrs).reduce((m, k) => {
      m[k] = `${attrs[k]}`;
      return m;
    }, {});
    if (options && !("silent" in options)) {
      options.silent = true;
    }
    setAttrs(finalAttrs, options, callback);
  }
  function setAttr(name, value) {
    getAttrs([name], v => {
      const setting = {};
      if (v[name] !== `${value}`) setting[name] = `${value}`;
      setAttrs(setting);
    });
  }
  function fillRepeatingSectionFromData(
    sectionName, dataList, autogen, callback) {
    callback = callback || (() => {});
    getSectionIDs(`repeating_${sectionName}`, idList => {
      const existingRowAttributes = [
        ...idList.map(id => `repeating_${sectionName}_${id}_name`),
        ...idList.map(id => `repeating_${sectionName}_${id}_autogen`)
      ];
      getAttrs(existingRowAttributes, v => {
        /* Delete auto-generated rows */
        if (autogen) {
          idList = idList.filter(id => {
            if (v[`repeating_${sectionName}_${id}_autogen`]) {
              removeRepeatingRow(`repeating_${sectionName}_${id}`);
              return false;
            } else return true;
          });
        }
        const existingRowNames = idList
          .map(id => v[`repeating_${sectionName}_${id}_name`]);
        const createdIDs = [];
        const setting = dataList.filter(o => !existingRowNames.includes(o.name))
          .map(o => {
            let rowID;
            while (!rowID) {
              let newID = generateRowID();
              if (!createdIDs.includes(newID)) {
                rowID = newID;
                createdIDs.push(rowID);
              }
            }
            const newAttrs = {};
            if (autogen) {
              newAttrs[`repeating_${sectionName}_${rowID}_autogen`] = "1";
            }
            return Object.keys(o).reduce((m, key) => {
              m[`repeating_${sectionName}_${rowID}_${key}`] = o[key];
              return m;
            }, newAttrs);
          })
          .reduce((m, o) => Object.assign(m, o), {});
        mySetAttrs(setting, {}, callback);
      });
    });
  }
  function diceMagic(num) {
    if (num > 0) {
      return `dice=${
        [...Array(num).keys()].map(() => "[[d6]]").join("&" + "#44" + "; ")
      }`;
    } else {
      return "zerodice=[[d6]]&" + "#44" + "; [[d6]]";
    }
  }
  function buildRollFormula(base) {
    return ` {{?{@{bonusdice}|${
      [0, 1, 2, 3, 4, 5, 6, -1, -2, -3]
        .map(n => `${n},${diceMagic(n + (parseInt(base) || 0))}`).join("|")
    }}}}`;
  }
  function buildNumdiceFormula() {
    return ` {{?{${getTranslationByKey("numberofdice")}|${
      [0, 1, 2, 3, 4, 5, 6].map(n => `${n},${diceMagic(n)}`).join("|")
    }}}}`;
  }
  function emptyFirstRowIfUnnamed(sectionName) {
    getSectionIDs(`repeating_${sectionName}`, idList => {
      const id = idList[0];
      getAttrs([`repeating_${sectionName}_${id}_name`], v => {
        if (!v[`repeating_${sectionName}_${id}_name`]) {
          removeRepeatingRow(`repeating_${sectionName}_${id}`);
        }
      });
    });
  }
  function handleBoxesFill(name, upToFour) {
    on(`change:${name}1 change:${name}2 change:${name}3 change:${name}4`,
      event => {
        if (event.sourceType !== "player") return;
        getAttrs([event.sourceAttribute], v => {
          const rName = event.sourceAttribute.slice(0, -1),
            setting = {};
          if (`${v[event.sourceAttribute]}` === "1") {
            switch (event.sourceAttribute.slice(-1)) {
            case "4":
              setting[`${rName}3`] = 1;
              /* falls through */
            case "3":
              setting[`${rName}2`] = 1;
              /* falls through */
            case "2":
              setting[`${rName}1`] = 1;
            }
          }
          if (`${v[event.sourceAttribute]}` === "0") {
            switch (event.sourceAttribute.slice(-1)) {
            case "1":
              setting[`${rName}2`] = 0;
              /* falls through */
            case "2":
              setting[`${rName}3`] = 0;
              /* falls through */
            case "3":
              if (upToFour) setting[`${rName}4`] = 0;
            }
          }
          mySetAttrs(setting);
        });
      });
  }
  function calculateResistance(attrName) {
    getAttrs([...actionData[attrName], `setting_resbonus_${attrName}`], v => {
      const total = actionData[attrName].map(x => v[x])
        .reduce((s, c) => s + (`${c}` === "0" ? 0 : 1), 0);
      mySetAttrs({
        [attrName]:
          total,
        [`${attrName}_formula`]:
          buildRollFormula(total + parseInt(v[`setting_resbonus_${attrName}`])),
      });
    });
  }
  function calculateVice () {
    getAttrs(Object.keys(actionData), v => {
      const total = Math.min(...Object.keys(v).map(x => parseInt(v[x]) || 0));
      setAttr("vice_formula", buildRollFormula(total));
    });
  }
  function calculateScars(event) {
    getAttrs([
      "setting_traumata_set",
      ...scarsDataFlat.map(x => `scars_${x}`)
    ], v => {
      const scarsType = v.setting_traumata_set === "0" ? "normal"
        : v.setting_traumata_set;
      if (scarsData[scarsType] && event.sourceType === "player") {
        const newScars = scarsData[scarsType]
          .reduce((m, name) => m + (parseInt(v[`scars_${name}`]) || 0), 0);
        setAttr("scars", newScars);
      }
    });
  }
  function calculateStashFormula() {
    getAttrs(["stash"], v => {
      setAttr("stash_formula", buildRollFormula(
        Math.floor(parseInt(v.stash) / 10)));
    });
  }
  function calculateWantedFormula() {
    getAttrs(["wanted"], v => {
      setAttr("wanted_formula", buildRollFormula(v.wanted));
    });
  }
  function calculateCohortDice(prefixes) {
    const sourceAttrs = [
      "crew_tier",
      ...prefixes.map(p => `${p}_impaired`),
      ...prefixes.map(p => `${p}_type`),
      ...prefixes.map(p => `${p}_roll_formula`),
    ];
    getAttrs(sourceAttrs, v => {
      const setting = {};
      prefixes.forEach(prefix => {
        const formula = buildRollFormula(
          (parseInt(v.crew_tier) || 0) -
          (parseInt(v[`${prefix}_impaired`]) || 0) +
          (["elite", "expert"].includes(v[`${prefix}_type`]) ? 1 : 0));
        if (formula !== v[`${prefix}_roll_formula`]) {
          setting[`${prefix}_roll_formula`] = formula;
        }
      });
      setAttrs(setting);
    });
  }
  function calculateCharCohortDice() {
    getAttrs(["char_cohort_quality", "char_cohort_impaired"], v => {
      const dice = (parseInt(v.char_cohort_quality) || 0) -
        (parseInt(v.char_cohort_impaired) || 0);
      setAttr("char_cohort_roll_formula", buildRollFormula(dice));
    });
  }
  function cleanChatImage(event) {
    const RE = /^(https:\/\/s3\.amazonaws\.com\/files\.d20\.io\/images\/.*)\/(?:med|max|original|thumb)\.(jpg|png)\?\d+$/;
    const match = (event.newValue || "").match(RE);
    if (match) setAttr("chat_image", `${match[1]}/thumb.${match[2]}`);
  }
  function handlePlaybookFill(event) {
    getAttrs([
      "playbook",
      "crew_type",
      "changed_attributes",
      "setting_autofill",
      ...watchedAttributes
    ], v => {
      const changedAttributes = (v.changed_attributes || "").split(",");
      const sourceName = translatedNames[
        (event.sourceAttribute === "crew_type" ? v.crew_type : v.playbook)
          .toLowerCase()];
      const fillBaseData = (data, defaultAttrNames) => {
        if (data) {
          const finalSettings = defaultAttrNames
            .filter(name => !changedAttributes.includes(name))
            // do not reset attributes which have been changed by the user
            .filter(name => !spiritPlaybooks.includes(sourceName) ||
              !actionsFlat.includes(name))
            // do not reset action dots if changing to a spirit playbook
            .filter(name => v[name] !== (defaultValues[name] || ""))
            // do not set attributes if current value is equal to sheet defaults
            .reduce((m, name) => {
              m[name] = defaultValues[name] || "";
              return m;
            }, {});
          Object.keys(data).filter(name => !changedAttributes.includes(name))
            .forEach(name => (finalSettings[name] = data[name]));
          mySetAttrs(finalSettings);
        }
      };
      if (event.sourceAttribute === "crew_type" ? v.crew_type : v.playbook) {
        setAttr("show_playbook_reminder", "0");
      }
      if (v.setting_autofill !== "1") return;
      if (event.sourceAttribute === "crew_type" && sourceName in crewData) {
        fillRepeatingSectionFromData("contact",
          crewData[sourceName].contact, true);
        fillRepeatingSectionFromData("crewability",
          crewData[sourceName].crewability, true);
        fillRepeatingSectionFromData("upgrade",
          crewData[sourceName].upgrade, true);
        fillBaseData(crewData[sourceName].base, crewAttributes);
      }
      if (event.sourceAttribute === "playbook" && sourceName in playbookData) {
        fillRepeatingSectionFromData("friend",
          playbookData[sourceName].friend, true);
        fillRepeatingSectionFromData("ability",
          playbookData[sourceName].ability, true);
        fillRepeatingSectionFromData("playbookitem",
          playbookData[sourceName].playbookitem, true);
        fillBaseData(playbookData[sourceName].base, playbookAttributes);
        if (sourceName === "leech" || sourceName === "zindiq") {
          fillRepeatingSectionFromData("alchemical", alchemicalData);
        }
      }
    });
  }
  function fillAbility(prefix, abilityMap) {
    getAttrs([`${prefix}_name`, `${prefix}_description`], v => {
      if (!v[`${prefix}_description`]) {
        const description = abilityMap.get((v[`${prefix}_name`] || "")
          .toLowerCase());
        if (description) setAttr(`${prefix}_description`, description);
      }
    });
  }
  function handleAutoExpandWhitespace(name) {
    on(`change:${name}`, event => {
      const attrName = name.replace(":", "_");
      getAttrs([attrName], v => {
        if (v[attrName].trim() !== v[attrName] &&
          event.sourceType === "player") {
          setAttr(attrName, v[attrName].trim());
        }
      });
    });
  }
  function handleCohortVerb(prefix) {
    const eventString = `change:${prefix}${
      (prefix === "repeating_cohort") ? ":" : "_"}type`;
    on(eventString, event => {
      const verb = (event.newValue === "expert") ?
        "^{rolls_their}" : "^{roll_their}";
      setAttr(`${prefix}_verb`, verb);
    });
  }
  function handleConsequenceQuery() {
    getAttrs(["setting_consequence_query"], v => {
      const consequenceQuery = (`${v.setting_consequence_query}` === "1") ?
        `?{${getTranslationByKey("consequence")}|${
          getTranslationByKey("a_consequence")}}` : "^{a_consequence}";
      setAttr("consequence_query", consequenceQuery);
    });
  }
  function handlePseudoRadio(name) {
    on(`change:${name}`, event => {
      if (`${event.newValue}` === "0" && event.sourceType === "player") {
        setAttr(name, (parseInt(event.previousValue) || 1) - 1);
      }
      setAttr(`${name}_formula`, buildRollFormula(event.newValue || "0"));
    });
  }
  function handleRepeatingGenerateButton(sectionName) {
    on(`change:generate_${sectionName}`, () => {
      getAttrs([
        "generate_source_character",
        "generate_source_crew",
        "sheet_type"
      ], v => {
        const data = (v.sheet_type === "character") ? playbookData : crewData,
          genSource = v[`generate_source_${v.sheet_type}`];
        if (genSource in data) {
          emptyFirstRowIfUnnamed(sectionName);
          fillRepeatingSectionFromData(sectionName,
            data[genSource][sectionName]);
        }
      });
    });
  }
  function handleSheetInit() {
    getAttrs(["sheet_type", "crew_type", "playbook"], v => {
      /* Make sure sheet_type is never 0 */
      if (!["crew", "faction"].includes(v.sheet_type)) {
        setAttr("sheet_type", "character");
      }
      /* Remove reminder box if we have playbook or crew name */
      if (v.playbook || v.crew_type) setAttr("show_playbook_reminder", "0");
    });
    /* Setup and upgrades */
    getAttrs(["version"], v => {
      const addVersion = (object, version) => {
        object.version = version;
        object.character_sheet = `Blades in the Dark v${version}`;
      };
      const upgradeSheet = version => {
        const versionMajor = version && parseInt(version.split(".")[0]),
          versionMinor = version && parseInt(version.split(".")[1]);
        console.log(`Found version ${version}.`);
        if (version !== sheetVersion) console.log("Performing sheet upgrade.");
        // Upgrade to 3.6: recalculate all formulas
        if (versionMajor === 3 && versionMinor < 6) {
          const setting = {};
          addVersion(setting, "3.6");
          recalculateDiceFormulas();
          mySetAttrs(setting, {}, () => upgradeSheet("3.6"));
        }
        // Fall back to upgrading to the newest version.
        else {
          const setting = {};
          addVersion(setting, sheetVersion);
          mySetAttrs(setting);
        }
      };
      const initialiseSheet = () => {
        const setting = [
          "ability",
          "friend",
          "crewability",
          "contact",
          "playbookitem",
          "upgrade",
          "framefeature"
        ].reduce((memo, sectionName) => {
          memo[`repeating_${sectionName}_${generateRowID()}_autogen`] = 1;
          return memo;
        }, {});
        addVersion(setting, sheetVersion);
        /* Set translated default values */
        getAttrs(Object.keys(translatedDefaults), v => {
          Object.keys(translatedDefaults).forEach(k => {
            if (v[k] !== translatedDefaults[k]) {
              setting[k] = translatedDefaults[k];
            }
          });
          mySetAttrs(setting);
          console.log("Initialising new sheet.");
        });
        fillRepeatingSectionFromData("item", itemData);
      };
      if (v.version) upgradeSheet(v.version);
      else initialiseSheet();
    });
  }
  function recalculateDiceFormulas() {
    getSectionIDs("repeating_cohort", idArray => {
      calculateCohortDice(
        [...idArray.map(id => `repeating_cohort_${id}`), "cohort1"]);
    });
    getAttrs([
      ...actionsFlat,
      "crew_tier",
      "char_cohort_quality",
      "char_cohort_impaired",
      "setting_show_cohort"
    ], v => {
      [...actionsFlat, "crew_tier"]
        .forEach(name => setAttr(`${name}_formula`,
          buildRollFormula(v[name])));
      if (v.setting_show_cohort === "1") {
        const dice = (parseInt(v.char_cohort_quality) || 0) -
          (parseInt(v.char_cohort_impaired) || 0);
        setAttr("char_cohort_roll_formula", buildRollFormula(dice));
      }
    });
    Object.keys(actionData).forEach(calculateResistance);
    calculateVice();
    calculateStashFormula();
    calculateWantedFormula();
  }
  function resetItems() {
    const clearChecks = sectionName => {
      getSectionIDs(`repeating_${sectionName}`, idArray => {
        const setting = [
          ...idArray.map(id => `repeating_${sectionName}_${id}_check_1`),
          ...idArray.map(id => `repeating_${sectionName}_${id}_check_2`),
          ...idArray.map(id => `repeating_${sectionName}_${id}_check_3`)
        ].reduce((m, name) => {
          m[name] = 0;
          return m;
        }, {});
        mySetAttrs(setting);
      });
    };
    setAttr("load", 0);
    ["item", "playbookitem"].forEach(clearChecks);
  }
  function setupTranslatedAttrs() {
    /* Set up translated attributes */
    const translatedAttrs = {
      bonusdice: getTranslationByKey("bonusdice"),
      effect_query: getTranslationByKey("effect_query"),
      notes_query: `?{${getTranslationByKey("notes")}}`,
      numberofdice: buildNumdiceFormula(),
      position_query: `?{${getTranslationByKey("position")}|${
        getTranslationByKey("risky")},position=${
        getTranslationByKey("risky")}|${
        getTranslationByKey("controlled")},position=${
        getTranslationByKey("controlled")}|${
        getTranslationByKey("desperate")},position=${
        getTranslationByKey("desperate")}|${
        getTranslationByKey("fortune_roll")},short=short}`,
      title_text: "",
    };
    getAttrs([
      ...Object.keys(translatedAttrs),
      "setting_usekirsty",
      "setting_custom_actions",
    ], v => {
      const lang = getTranslationLanguage();
      const kirsty = v.setting_usekirsty === "1" ? " {{kirsty=1}}" : "";
      let hasTitleText = v.setting_custom_actions === "1";
      let languageSuffix = "";
      if (["fr", "es", "ko", "pt"].includes(lang)) {
        hasTitleText = true;
        languageSuffix = `{{language=i18n-${lang}}} `;
      }
      translatedAttrs.title_text =
        `${hasTitleText ? "{{title-text=1}} " : ""}${languageSuffix}${kirsty}`;
      const setting = {};
      Object.keys(translatedAttrs).forEach(name => {
        if (v[name] !== translatedAttrs[name]) {
          setting[name] = translatedAttrs[name];
        }
      });
      mySetAttrs(setting);
    });
  }
  function updateChangedAttrs(event) {
    if (event.sourceType === "player") {
      getAttrs(["changed_attributes"], v => {
        const changedAttributes = [
          ...new Set(v.changed_attributes.split(","))
            .add(event.sourceAttribute)
        ].filter(x => !!x).join(",");
        setAttr("changed_attributes", changedAttributes);
      });
    }
  }
  function watchAutogen(sectionName) {
    on(`change:repeating_${sectionName}`, event => {
      getAttrs([`repeating_${sectionName}_autogen`], v => {
        if (v[`repeating_${sectionName}_autogen`] &&
          event.sourceType === "player") {
          setAttr(`repeating_${sectionName}_autogen`, "");
        }
      });
    });
  }
  function handleDarkTalentChange(attribute) {
    getAttrs([
      `setting_dark_talent_${attribute}`,
      `setting_resbonus_${attribute}`
    ], v => {
      const resistanceBonus =
        (parseInt(v[`setting_resbonus_${attribute}`]) || 0) +
        ((`${v[`setting_dark_talent_${attribute}`]}` === "1") ? 1 : -1);
      setAttr(`setting_resbonus_${attribute}`, resistanceBonus);
    });
  }
  function generateFactions() {
    setAttr("show_faction_generatebutton", "0");
    Object.keys(factionsData).forEach(sectionName => {
      fillRepeatingSectionFromData(sectionName, factionsData[sectionName]);
    });
  }
  function setRollMods() {
    getAttrs(["setting_custom_actions"], v => {
      function getRollMods(prefix) {
        if (v.setting_custom_actions == "0") {
          return "";
        } else {
          return `{{title=@{${prefix}_label}}}`;
        }
      }
      const setting = {};
      Object.keys(actionData).forEach(attribute => {
        setting[`${attribute}_roll_mods`] = getRollMods(attribute);
        actionData[attribute].forEach(action => {
          setting[`${action}_roll_mods`] = getRollMods(action);
        });
      });
      mySetAttrs(setting);
    });
  }
  /* DATA */
  const sheetVersion = "3.9";
  const crewData = {
  };
  const playbookData = {
    cutter: {
      ability: ["battleborn", "bodyguard", "ghost_fighter", "leader", "mule", "not_to_be_trifled_with", "savage", "vigorous", "veteran"],
      base: {
        command: "1",
        friends_title: "playbook_cutter_friends_title",
        gatherinfo1: "gatherinfo_how_can_I_hurt",
        gatherinfo2: "gatherinfo_whos_most_afraid",
        gatherinfo3: "gatherinfo_whos_most_dangerous",
        gatherinfo4: "gatherinfo_what_do_they_intend",
        gatherinfo5: "gatherinfo_how_can_I_get_them",
        gatherinfo6: "gatherinfo_are_they_telling",
        playbook_description: "playbook_cutter_description",
        skirmish: "2",
        xp_condition: "playbook_cutter_xp_condition"
      },
      playbookitem: [{
        bold: "1",
        name: "playbook_item_fine_hand_weapon",
        numboxes: "1"
      }, {
        bold: "1",
        name: "playbook_item_fine_heavy_weapon",
        numboxes: "2"
      }, {
        name: "playbook_item_scary_weapon_or_tool",
        numboxes: "1"
      }, {
        name: "playbook_item_manacles_&_chain",
        numboxes: "0"
      }, {
        name: "playbook_item_rage_essence_vial",
        numboxes: "0"
      }, {
        name: "playbook_item_spiritbane_charm",
        name: "playbook_item_spiritbane_charm",
        numboxes: "0"
      }]
    }
  };
  const factionsData = {
  };
  const actionData = {
    insight: [
      "hunt",
      "study",
      "survey",
      "tinker"
    ],
    prowess: [
      "finesse",
      "prowl",
      "skirmish",
      "wreck"
    ],
    resolve: [
      "attune",
      "command",
      "consort",
      "sway"
    ]
  };
  const scarsData = {
  };
  const itemData = [
    {
      name: "i_blackjack",
      numboxes: "2"
    },
    {
      name: "i_a_blade_or_two",
      numboxes: "1"
    },
    {
      name: "i_spear",
      numboxes: "3"
    },
    {
      name: "i_longsword",
      numboxes: "2"
    },
    {
      name: "i_pistol",
      numboxes: "1"
    },
    {
      name: "i_second_pistol",
      numboxes: "1"
    },
    {
      name: "i_rifle",
      numboxes: "2"
    },
    {
      name: "i_crossbow",
      numboxes: "3"
    },
    {
      name: "i_shortbow",
      numboxes: "3"
    },
    {
      name: "i_hunting_bow",
      numboxes: "3"
    },
    {
      name: "i_longbow",
      numboxes: "3"
    },
    {
      name: "i_buckler",
      numboxes: "1"
    },
    {
      name: "i_round_shield",
      numboxes: "2"
    },
    {
      name: "i_knightly_shield",
      numboxes: "3"
    },
    {
      name: "i_leather_armor",
      numboxes: "2"
    },
    {
      name: "i_chainmail",
      numboxes: "3"
    },
    {
      name: "i_plated_jacket",
      numboxes: "3"
    },
    {
      name: "i_lantern",
      numboxes: "1"
    },
    {
      name: "i_censer",
      numboxes: "1"
    },
    {
      name: "i_manna_wood",
      numboxes: "1"
    },
    {
      name: "i_burglary_kit",
      numboxes: "1"
    },
    {
      name: "i_tinkering_tools",
      numboxes: "2"
    },
    {
      name: "i_demolition_tools",
      numboxes: "2"
    },
    {
      name: "i_subterfuge_supplies",
      numboxes: "1"
    },
    {
      name: "i_climbing_gear",
      numboxes: "1"
    },
    {
      name: "i_ashwood",
      numboxes: "1"
    },
    {
      name: "i_black_powder",
      numboxes: "1"
    }
  ];
  const translatedDefaults = {
    char_cohort_name: "cohort",
    cohort1_name: "cohort",
    contacts_title: "contacts",
    factions_title: "factions_title",
    factions1_header: "factions1",
    factions2_header: "factions2",
    factions3_header: "factions3",
    factions4_header: "factions4",
    factions5_header: "factions5",
    frame: "frame",
    friends_title: "friends",
    setting_alchemicals_label: "alchemicals",
    setting_deity_label: "deity",
    setting_heat_label: "heat",
    setting_stress_label: "stress",
    setting_scars_label: "scars",
    setting_wanted_label: "wanted",
    special_abilities_title: "special_abilities",
    upgrade_carriage_name: "carriage",
    upgrade_carriage_description: "upgrade_carriage_description",
    upgrade_documents_name: "documents",
    upgrade_documents_description: "upgrade_documents_description",
    upgrade_boat_name: "boat",
    upgrade_boat_description: "upgrade_boat_description",
    upgrade_gear_name: "gear",
    upgrade_gear_description: "upgrade_gear_description",
    upgrade_hidden_name: "hidden",
    upgrade_hidden_description: "upgrade_hidden_description",
    upgrade_implements_name: "implements",
    upgrade_implements_description: "upgrade_implements_description",
    upgrade_quarters_name: "quarters",
    upgrade_quarters_description: "upgrade_quarters_description",
    upgrade_supplies_name: "supplies",
    upgrade_supplies_description: "upgrade_supplies_description",
    upgrade_secure_name: "secure",
    upgrade_secure_description: "upgrade_secure_description",
    upgrade_tools_name: "tools",
    upgrade_tools_description: "upgrade_tools_description",
    upgrade_vault_name: "vault",
    upgrade_vault_description: "upgrade_vault_description",
    upgrade_weapons_name: "weapons",
    upgrade_weapons_description: "upgrade_weapons_description",
    upgrade_workshop_name: "workshop",
    upgrade_workshop_description: "upgrade_workshop_description",
    upgrade_insight_name: "insight",
    upgrade_insight_description: "upgrade_insight_description",
    upgrade_prowess_name: "prowess",
    upgrade_prowess_description: "upgrade_prowess_description",
    upgrade_resolve_name: "resolve",
    upgrade_resolve_description: "upgrade_resolve_description",
    upgrade_personal_name: "personal",
    upgrade_personal_description: "upgrade_personal_description",
    upgrade_mastery_name: "mastery",
    upgrade_mastery_description: "upgrade_mastery_description",
    xp_condition2: "xp_beliefs",
    xp_condition3: "xp_vice"
  };
  const defaultValues = {
    attune: "0",
    char_cohort_quality: "1",
    char_cohort_type: "expert",
    claim_bridge_10_15: "1",
    claim_bridge_12_13: "1",
    claim_bridge_13_14: "1",
    claim_bridge_2_3: "1",
    claim_bridge_2_7: "1",
    claim_bridge_3_4: "1",
    claim_bridge_4_9: "1",
    claim_bridge_6_11: "1",
    claim_bridge_6_7: "1",
    claim_bridge_9_14: "1",
    cohort1_subtype: "",
    cohort1_type: "gang",
    command: "0",
    consort: "0",
    finesse: "0",
    hunt: "0",
    prowl: "0",
    setting_extra_stress: "0",
    setting_load_h: "6",
    setting_show_bandolier: "0",
    setting_show_cohort: "0",
    setting_show_deity: "0",
    setting_show_frame: "0",
    setting_show_origin: "0",
    setting_show_strictures: "0",
    setting_traumata_set: "normal",
    setting_vice_type: "normal",
    skirmish: "0",
    study: "0",
    survey: "0",
    sway: "0",
    tinker: "0",
    scars: "0",
    upgrade_hidden_check_1: "0",
    upgrade_secure_check_1: "0",
    upgrade_insight_check_1: "0",
    upgrade_prowess_check_1: "0",
    upgrade_resolve_check_1: "0",
    upgrade_carriage_check_1: "0",
    wreck: "0"
  };
  const spiritPlaybooks = ["ghost", "hull", "vampire"];
  const alchemicalData = [
    "alcahest",
    "binding_oil",
    "drift_oil",
    "drown_powder",
    "eyeblind_poison",
    "fire_oil",
    "grenade",
    "quicksilver",
    "skullfire_poison",
    "smoke_bomb",
    "spark_drug",
    "standstill_poison",
    "trance_powder",
  ];
  /* PRE-COMPUTED CONSTANTS */
  const [playbookAbilityMap, crewAbilityMap] = dataSetup();
  const crewAttributes = [...new Set(
    [].concat(...Object.keys(crewData).map(x => Object.keys(crewData[x].base)))
  )];
  const playbookAttributes = [...new Set(
    [].concat(...Object.keys(playbookData)
      .map(x => Object.keys(playbookData[x].base)))
  )];
  const watchedAttributes =
    [...new Set(crewAttributes.concat(playbookAttributes))];
  const actionsFlat =
    [].concat(...Object.keys(actionData).map(x => actionData[x]));
  const scarsDataFlat = Object.keys(scarsData)
    .reduce((m, k) => m.concat(scarsData[k]), []);
  const autoExpandFields = [
    "repeating_ability:name",
    "repeating_ability:description",
    "repeating_crewability:name",
    "repeating_crewability:description",
    "repeating_playbookitem:name",
    "repeating_upgrade:name",
    "repeating_friend:name",
    "repeating_contact:name",
    "repeating_clock:name",
    "repeating_crewclock:name",
    "repeating_factionclock:name",
    "repeating_cohort:edges",
    "repeating_cohort:flaws",
    "repeating_alchemical:name",
    "xp_condition",
    "xp_condition_extra",
    "xp_condition2",
    "xp_condition3",
    "crew_xp_condition",
    "hunting_grounds_type",
    "hunting_grounds_description",
    "cohort1_edges",
    "cohort1_flaws",
    "heritage",
    "background",
    "vice_purveyor",
  ];
  const autogenSections = [
    "ability",
    "crewability",
    "friend",
    "contact",
    "playbookitem",
    "upgrade"
  ];
  const translatedNames = [
    ...Object.keys(playbookData),
    ...Object.keys(crewData)
  ].reduce((m, keyName) => {
    if (getTranslationByKey(keyName)) {
      m[getTranslationByKey(keyName).toLowerCase()] = keyName;
    }
    return m;
  }, {});
  /* EVENT HANDLERS */
  /* Set default fields when setting crew type or playbook */
  on("change:crew_type change:playbook", handlePlaybookFill);
  /* automatically fill abilities */
  on("change:repeating_ability:name",
    () => fillAbility("repeating_ability", playbookAbilityMap));
  on("change:repeating_crewability:name",
    () => fillAbility("repeating_crewability", crewAbilityMap));
  /* Watch repeating rows for changes and set autogen to false if it changes */
  autogenSections.forEach(watchAutogen);
  /* Watch for changes in auto-set attributes and update changed_attributes */
  on(watchedAttributes.map(x => `change:${x}`).join(" "), updateChangedAttrs);
  /* Register attribute/action event handlers */
  Object.keys(actionData).forEach(attrName => {
    on([...actionData[attrName], `setting_resbonus_${attrName}`]
      .map(x => `change:${x}`).join(" "), () => calculateResistance(attrName)
    );
    on(`change:setting_dark_talent_${attrName}`,
      () => handleDarkTalentChange(attrName));
    on(`change:${attrName}`, calculateVice);
  });
  /* Calculate stash */
  on("change:stash", calculateStashFormula);
  on("change:wanted", calculateWantedFormula);
  /* Calculate scars */
  on("change:setting_traumata_set " +
    scarsDataFlat.map(x => `change:scars_${x}`).join(" "), calculateScars);
  /* Generate buttons */
  on("change:generate_factions", generateFactions);
  autogenSections.forEach(handleRepeatingGenerateButton);
  /* Extra stress and scars */
  on("change:setting_extra_stress", event =>
    setAttr("stress_max", 9 + (parseInt(event.newValue) || 0)));
  on("change:setting_extra_scars", event =>
    setAttr("scars_max", 4 + (parseInt(event.newValue) || 0)));
  /* Calculate cohort quality */
  on(
    ["crew_tier", "cohort1_impaired", "cohort1_type"]
      .map(x => `change:${x}`).join(" "),
    () => calculateCohortDice(["cohort1"]));
  on("change:repeating_cohort",
    () => calculateCohortDice(["repeating_cohort"]));
  on("change:crew_tier", () => {
    getSectionIDs("repeating_cohort",
      a => calculateCohortDice(a.map(id => `repeating_cohort_${id}`)));
  });
  on("change:char_cohort_quality change:char_cohort_impaired " +
    "change:setting_show_cohort", calculateCharCohortDice);
  /* Set correct verb for cohort roll button */
  ["char_cohort", "cohort1", "repeating_cohort"].forEach(handleCohortVerb);
  /* Left-fill checkboxes */
  handleBoxesFill("upgrade_mastery_check_", true);
  handleBoxesFill("bandolier1_check_");
  handleBoxesFill("bandolier2_check_");
  ["item", "playbookitem", "upgrade"]
    .forEach(sName => handleBoxesFill(`repeating_${sName}:check_`));
  /* Pseudo-radios */
  ["crew_tier", ...actionsFlat].forEach(handlePseudoRadio);
  /* Item reset button */
  on("change:reset_items", resetItems);
  /* Resistance query */
  on("change:setting_consequence_query sheet:opened", handleConsequenceQuery);
  /* Trim whitespace in auto-expand fields */
  autoExpandFields.forEach(handleAutoExpandWhitespace);
  /* Clean chat image URL */
  on("change:chat_image", cleanChatImage);
  /* Number of dice prompt and other translation-dependent atoms */
  on("sheet:opened change:setting_usekirsty change:setting_custom_actions",
    setupTranslatedAttrs);
  on("change:setting_custom_actions", setRollMods);
  /* INITIALISATION AND UPGRADES */
  on("sheet:opened", handleSheetInit);
})();}
)();
</script>
